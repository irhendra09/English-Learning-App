<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Learning App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f8f8; /* Light background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .app-container {
            max-width: 700px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1rem; /* Rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .card {
            background-color: #f0f9ff; /* Light blue background for card */
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            border: 1px solid #e0f2fe;
        }
        .word-display h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        .word-display p {
            font-size: 1.125rem;
            color: #4a5568;
        }
        .word-display .meaning {
            font-style: italic;
            color: #2b6cb0; /* Darker blue for meaning */
        }
        .word-display .sentence {
            margin-top: 0.75rem;
            font-size: 1rem;
            color: #718096;
        }
        .control-buttons button,
        .quiz-options button,
        .search-container button,
        .pronounce-buttons button,
        .sentence-quiz-controls button,
        .speech-practice-controls button { /* Added .speech-practice-controls button */
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .control-buttons button:hover,
        .quiz-options button:hover,
        .search-container button:hover,
        .pronounce-buttons button:hover,
        .sentence-quiz-controls button:hover,
        .speech-practice-controls button:hover { /* Added .speech-practice-controls button */
            transform: translateY(-2px);
        }
        .control-buttons button:active,
        .quiz-options button:active,
        .search-container button:active,
        .pronounce-buttons button:active,
        .sentence-quiz-controls button:active,
        .speech-practice-controls button:active { /* Added .speech-practice-controls button */
            transform: translateY(0);
            box-shadow: none;
        }
        .btn-primary {
            background-color: #4299e1; /* Blue */
            color: white;
        }
        .btn-primary:hover {
            background-color: #3182ce;
        }
        .btn-secondary {
            background-color: #a0aec0; /* Gray */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #718096;
        }
        .btn-success {
            background-color: #48bb78; /* Green */
            color: white;
        }
        .btn-success:hover {
            background-color: #38a169;
        }
        .btn-danger {
            background-color: #ef4444; /* Red */
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .search-container input[type="text"] {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.5rem;
            outline: none;
            font-size: 1rem;
        }
        .search-container input[type="text"]:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.5);
        }
        .quiz-section {
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        .quiz-section.active {
            display: flex;
        }
        .quiz-question {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1rem;
        }
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
        @media (min-width: 640px) {
            .quiz-options {
                grid-template-columns: 1fr 1fr;
            }
        }
        .quiz-feedback {
            margin-top: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .favorite-button {
            background-color: #ecc94b; /* Yellow for favorite */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .favorite-button.favorited {
            background-color: #f6ad55; /* Darker yellow when favorited */
        }
        .favorite-button:hover {
            background-color: #d69e2e;
            transform: translateY(-2px);
        }
        .favorite-button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .favorite-button .star-icon {
            margin-right: 0.5rem;
        }
        .theme-display {
            font-size: 0.9rem;
            color: #63b3ed;
            font-weight: 600;
            margin-top: 0.5rem;
        }
        .pronounce-buttons { /* Styling for the new button container */
            display: flex;
            flex-wrap: wrap; /* Added flex-wrap for responsiveness */
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .rate-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center;
            font-size: 0.9rem;
            color: #4a5568;
        }
        .rate-control input[type="range"] {
            width: 100%; /* Changed to 100% for responsiveness */
            max-width: 150px; /* Added max-width to keep it from being too wide on large screens */
            -webkit-appearance: none;
            height: 8px;
            background: #cbd5e0;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        .rate-control input[type="range"]:hover {
            opacity: 1;
        }
        .rate-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4299e1;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .rate-control input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4299e1;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Sentence Reordering Quiz Specific Styles */
        .sentence-quiz-container {
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }
        .sentence-quiz-container.active {
            display: flex;
        }
        .scrambled-words-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            min-height: 60px;
            border: 1px dashed #cbd5e0;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #edf2f7;
        }
        .scrambled-word-button {
            background-color: #63b3ed; /* Light blue for scrambled words */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .scrambled-word-button:hover:not(:disabled) {
            background-color: #4299e1;
        }
        .scrambled-word-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #a0aec0; /* Gray when used */
        }
        .sentence-builder-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            min-height: 60px;
            border: 2px solid #4299e1; /* Blue border for builder area */
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: #e0f2fe; /* Lighter blue */
            font-size: 1.1rem;
            font-weight: 500;
            color: #2d3748;
            text-align: left;
        }
        .sentence-builder-display .built-word {
            background-color: #bee3f8; /* Even lighter blue for built words */
            color: #2b6cb0;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: 1px solid #90cdf4;
        }
        .sentence-builder-display .built-word:hover {
            background-color: #a7d9f8;
        }
        .sentence-quiz-controls {
            display: flex;
            flex-wrap: wrap; /* Added flex-wrap for responsiveness */
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* Speech Practice Specific Styles */
        .speech-practice-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed #cbd5e0;
        }
        .speech-practice-controls {
            display: flex;
            flex-wrap: wrap; /* Added flex-wrap for responsiveness */
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .speech-recognized-text {
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: #2d3748;
            min-height: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.75rem;
            background-color: #f7fafc;
            text-align: left;
        }
        .speech-feedback {
            margin-top: 0.75rem;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .speech-feedback.correct {
            color: #48bb78; /* Green */
        }
        .speech-feedback.incorrect {
            color: #ef4444; /* Red */
        }
        .speech-feedback.listening {
            color: #4299e1; /* Blue */
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 480px) {
            .app-container {
                padding: 1rem;
            }
            .word-display h2 {
                font-size: 2rem;
            }
            .word-display p {
                font-size: 1rem;
            }
            .control-buttons button,
            .pronounce-buttons button,
            .sentence-quiz-controls button,
            .speech-practice-controls button {
                width: 100%; /* Make buttons full width on small screens */
                padding: 0.6rem 1rem;
            }
            .search-container {
                flex-direction: column; /* Stack search input and button */
                gap: 0.75rem;
            }
            .search-container button {
                width: 100%;
            }
            .rate-control {
                flex-direction: column; /* Stack speed label and slider */
                gap: 0.75rem;
            }
            .rate-control input[type="range"] {
                max-width: 100%; /* Allow slider to take full width */
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <h1 class="text-4xl font-bold text-center text-gray-800">English Learning App</h1>

        <div class="card word-display">
            <div class="flex justify-between items-center mb-2">
                <span id="wordTheme" class="theme-display"></span>
                <button id="favoriteButton" class="favorite-button">
                    <span class="star-icon">‚òÖ</span> Favorite
                </button>
            </div>
            <h2 id="word">Loading...</h2>
            <p id="meaning" class="meaning">Loading meaning...</p>
            <p id="sentence" class="sentence">Loading sample sentence...</p>
            <div class="pronounce-buttons">
                <button id="pronounceWordButton" class="btn-primary">üîä Pronounce Word</button>
                <button id="pronounceSentenceButton" class="btn-primary">üîä Pronounce Sentence</button>
            </div>
            <div class="rate-control">
                <span>Speed:</span>
                <input type="range" id="speechRate" min="0.5" max="2" value="1" step="0.1">
                <span id="currentRate">1.0x</span>
            </div>

            <div class="speech-practice-section">
                <h3 class="text-xl font-bold text-gray-700">Pronunciation Practice</h3>
                <div class="speech-practice-controls">
                    <button id="startSpeechButton" class="btn-success">üé§ Start Practice</button>
                    <button id="stopSpeechButton" class="btn-danger" disabled>‚èπ Stop Practice</button>
                </div>
                <p id="speechRecognizedText" class="speech-recognized-text">Say the word or sentence...</p>
                <p id="speechFeedback" class="speech-feedback"></p>
            </div>
        </div>

        <div class="control-buttons flex flex-wrap justify-center gap-4">
            <button id="prevButton" class="btn-secondary">‚Üê Previous Word</button>
            <button id="nextButton" class="btn-primary">Next Word ‚Üí</button>
            <button id="shuffleButton" class="btn-secondary">üîÄ Shuffle</button>
            <button id="toggleQuizButton" class="btn-success">Start Quiz</button>
        </div>

        <div class="search-container flex gap-2 mt-4">
            <input type="text" id="searchInput" placeholder="Search for a word..." class="flex-grow">
            <button id="searchButton" class="btn-primary">üîç Search</button>
        </div>

        <div id="quizSection" class="quiz-section card">
            <h3 class="text-2xl font-bold text-gray-700">Quiz Time!</h3>
            <p id="quizQuestion" class="quiz-question"></p>

            <div id="meaningQuizOptions" class="quiz-options">
                </div>

            <div id="sentenceQuizContainer" class="sentence-quiz-container">
                <div id="scrambledWordsContainer" class="scrambled-words-display"></div>
                <div id="sentenceBuilderContainer" class="sentence-builder-display"></div>
                <div class="sentence-quiz-controls">
                    <button id="checkSentenceButton" class="btn-primary">Check Sentence</button>
                    <button id="resetSentenceButton" class="btn-secondary">Reset</button>
                </div>
            </div>

            <p id="quizFeedback" class="quiz-feedback"></p>
            <button id="nextQuizButton" class="btn-primary mx-auto mt-4 w-fit" style="display: none;">Next Question</button>
            <button id="exitQuizButton" class="btn-danger mx-auto mt-4 w-fit">Exit Quiz</button>
        </div>
    </div>

    <script>
        // Vocabulary data
        const vocabulary = [
								{
									"word": "Wake up",
									"meaning": "Bangun tidur",
									"sentence": "I wake up at 6 AM every day.",
									"theme": "Daily Activities"
								},
								{
									"word": "Brush",
									"meaning": "Menggosok",
									"sentence": "I brush my teeth after breakfast.",
									"theme": "Daily Activities"
								},
								{
									"word": "Shower",
									"meaning": "Mandi",
									"sentence": "She takes a shower in the morning.",
									"theme": "Daily Activities"
								},
								{
									"word": "Eat",
									"meaning": "Makan",
									"sentence": "We eat lunch at 1 PM.",
									"theme": "Daily Activities"
								},
								{
									"word": "Drink",
									"meaning": "Minum",
									"sentence": "I drink water when I\u2019m thirsty.",
									"theme": "Daily Activities"
								},
								{
									"word": "Sleep",
									"meaning": "Tidur",
									"sentence": "He sleeps at 10 PM.",
									"theme": "Daily Activities"
								},
								{
									"word": "Study",
									"meaning": "Belajar",
									"sentence": "I study English every night.",
									"theme": "Daily Activities"
								},
								{
									"word": "Work",
									"meaning": "Bekerja",
									"sentence": "My dad works at a bank.",
									"theme": "Daily Activities"
								},
								{
									"word": "Cook",
									"meaning": "Memasak",
									"sentence": "My mom cooks delicious food.",
									"theme": "Daily Activities"
								},
								{
									"word": "Clean",
									"meaning": "Membersihkan",
									"sentence": "I clean my room on Sunday.",
									"theme": "Daily Activities"
								},
								{
									"word": "Read",
									"meaning": "Membaca",
									"sentence": "She reads a book before bed.",
									"theme": "Daily Activities"
								},
								{
									"word": "Write",
									"meaning": "Menulis",
									"sentence": "I write in my journal.",
									"theme": "Daily Activities"
								},
								{
									"word": "Listen",
									"meaning": "Mendengarkan",
									"sentence": "They listen to music.",
									"theme": "Daily Activities"
								},
								{
									"word": "Watch",
									"meaning": "Menonton",
									"sentence": "We watch movies on weekends.",
									"theme": "Daily Activities"
								},
								{
									"word": "Play",
									"meaning": "Bermain",
									"sentence": "The kids play in the park.",
									"theme": "Daily Activities"
								},
								{
									"word": "Happy",
									"meaning": "Bahagia",
									"sentence": "I feel happy today.",
									"theme": "Emotions"
								},
								{
									"word": "Sad",
									"meaning": "Sedih",
									"sentence": "She looks sad.",
									"theme": "Emotions"
								},
								{
									"word": "Angry",
									"meaning": "Marah",
									"sentence": "He is angry because of the noise.",
									"theme": "Emotions"
								},
								{
									"word": "Excited",
									"meaning": "Bersemangat",
									"sentence": "We are excited for the trip!",
									"theme": "Emotions"
								},
								{
									"word": "Nervous",
									"meaning": "Gugup",
									"sentence": "I'm nervous before the test.",
									"theme": "Emotions"
								},
								{
									"word": "Bored",
									"meaning": "Bosan",
									"sentence": "I get bored during long meetings.",
									"theme": "Emotions"
								},
								{
									"word": "Tired",
									"meaning": "Lelah",
									"sentence": "She\u2019s tired after running.",
									"theme": "Emotions"
								},
								{
									"word": "Scared",
									"meaning": "Takut",
									"sentence": "The kid is scared of the dark.",
									"theme": "Emotions"
								},
								{
									"word": "Surprised",
									"meaning": "Terkejut",
									"sentence": "I was surprised by the gift.",
									"theme": "Emotions"
								},
								{
									"word": "Calm",
									"meaning": "Tenang",
									"sentence": "Stay calm during emergencies.",
									"theme": "Emotions"
								},
								{
									"word": "Confused",
									"meaning": "Bingung",
									"sentence": "He\u2019s confused about the homework.",
									"theme": "Emotions"
								},
								{
									"word": "Proud",
									"meaning": "Bangga",
									"sentence": "I\u2019m proud of you!",
									"theme": "Emotions"
								},
								{
									"word": "Shy",
									"meaning": "Pemalu",
									"sentence": "She is shy in public.",
									"theme": "Emotions"
								},
								{
									"word": "Jealous",
									"meaning": "Iri/cemburu",
									"sentence": "He\u2019s jealous of his brother.",
									"theme": "Emotions"
								},
								{
									"word": "Grateful",
									"meaning": "Bersyukur",
									"sentence": "I\u2019m grateful for my family.",
									"theme": "Emotions"
								},
								{
									"word": "Chair",
									"meaning": "Kursi",
									"sentence": "I sit on the chair.",
									"theme": "Home"
								},
								{
									"word": "Table",
									"meaning": "Meja",
									"sentence": "The books are on the table.",
									"theme": "Home"
								},
								{
									"word": "Bed",
									"meaning": "Tempat tidur",
									"sentence": "I sleep on a soft bed.",
									"theme": "Home"
								},
								{
									"word": "Window",
									"meaning": "Jendela",
									"sentence": "Please open the window.",
									"theme": "Home"
								},
								{
									"word": "Door",
									"meaning": "Pintu",
									"sentence": "Close the door, please.",
									"theme": "Home"
								},
								{
									"word": "Lamp",
									"meaning": "Lampu",
									"sentence": "Turn on the lamp, it\u2019s dark.",
									"theme": "Home"
								},
								{
									"word": "Mirror",
									"meaning": "Cermin",
									"sentence": "She looks in the mirror.",
									"theme": "Home"
								},
								{
									"word": "Sofa",
									"meaning": "Sofa",
									"sentence": "We relax on the sofa.",
									"theme": "Home"
								},
								{
									"word": "Clock",
									"meaning": "Jam dinding",
									"sentence": "The clock shows 9 o'clock.",
									"theme": "Home"
								},
								{
									"word": "Carpet",
									"meaning": "Karpet",
									"sentence": "The carpet is dirty.",
									"theme": "Home"
								},
								{
									"word": "TV",
									"meaning": "Televisi",
									"sentence": "They watch TV together.",
									"theme": "Home"
								},
								{
									"word": "Fan",
									"meaning": "Kipas angin",
									"sentence": "The fan keeps the room cool.",
									"theme": "Home"
								},
								{
									"word": "Fridge",
									"meaning": "Kulkas",
									"sentence": "Milk is in the fridge.",
									"theme": "Home"
								},
								{
									"word": "Shelf",
									"meaning": "Rak",
									"sentence": "I put my books on the shelf.",
									"theme": "Home"
								},
								{
									"word": "Curtain",
									"meaning": "Tirai/gorden",
									"sentence": "She opened the curtain to let light in.",
									"theme": "Home"
								},
								{
									"word": "Bread",
									"meaning": "Roti",
									"sentence": "I eat bread for breakfast.",
									"theme": "Food"
								},
								{
									"word": "Rice",
									"meaning": "Nasi",
									"sentence": "We always eat rice at lunch.",
									"theme": "Food"
								},
								{
									"word": "Chicken",
									"meaning": "Ayam",
									"sentence": "She cooks spicy chicken.",
									"theme": "Food"
								},
								{
									"word": "Fish",
									"meaning": "Ikan",
									"sentence": "He doesn\u2019t like fish.",
									"theme": "Food"
								},
								{
									"word": "Egg",
									"meaning": "Telur",
									"sentence": "I boiled two eggs.",
									"theme": "Food"
								},
								{
									"word": "Soup",
									"meaning": "Sup",
									"sentence": "This soup is hot and tasty.",
									"theme": "Food"
								},
								{
									"word": "Noodles",
									"meaning": "Mie",
									"sentence": "I love eating noodles!",
									"theme": "Food"
								},
								{
									"word": "Apple",
									"meaning": "Apel",
									"sentence": "She eats an apple a day.",
									"theme": "Food"
								},
								{
									"word": "Banana",
									"meaning": "Pisang",
									"sentence": "Bananas are yellow.",
									"theme": "Food"
								},
								{
									"word": "Water",
									"meaning": "Air",
									"sentence": "Drink more water every day.",
									"theme": "Food"
								},
								{
									"word": "Juice",
									"meaning": "Jus",
									"sentence": "Orange juice is my favorite.",
									"theme": "Food"
								},
								{
									"word": "Milk",
									"meaning": "Susu",
									"sentence": "Kids should drink milk.",
									"theme": "Food"
								},
								{
									"word": "Tea",
									"meaning": "Teh",
									"sentence": "Let\u2019s have a cup of tea.",
									"theme": "Food"
								},
								{
									"word": "Coffee",
									"meaning": "Kopi",
									"sentence": "He drinks coffee in the morning.",
									"theme": "Food"
								},
								{
									"word": "Snack",
									"meaning": "Camilan",
									"sentence": "I bring snacks to school.",
									"theme": "Food"
								}
							];

        let currentWordIndex = 0;
        let favoriteWords = JSON.parse(localStorage.getItem('favoriteWords')) || [];
        let inQuizMode = false;
        let currentQuizWord = null;
        let currentQuizType = 'meaning'; // 'meaning' or 'sentence'

        // Variables for Sentence Reordering Quiz
        let originalSentenceWords = []; // The correct words from the sentence, cleaned
        let scrambledWordButtons = []; // Array of { word: string, buttonElement: HTMLElement, originalIndex: number }
        let builtSentenceWords = []; // Words currently in the sentence builder

        // Web Speech Recognition variables
        let recognition;
        let isRecognizing = false;

        // Get DOM elements
        const wordElement = document.getElementById('word');
        const meaningElement = document.getElementById('meaning');
        const sentenceElement = document.getElementById('sentence');
        const wordThemeElement = document.getElementById('wordTheme');
        const pronounceWordButton = document.getElementById('pronounceWordButton');
        const pronounceSentenceButton = document.getElementById('pronounceSentenceButton');
        const speechRateInput = document.getElementById('speechRate');
        const currentRateDisplay = document.getElementById('currentRate');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const shuffleButton = document.getElementById('shuffleButton');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const favoriteButton = document.getElementById('favoriteButton');
        const toggleQuizButton = document.getElementById('toggleQuizButton');
        const quizSection = document.getElementById('quizSection');
        const quizQuestionElement = document.getElementById('quizQuestion');
        const meaningQuizOptions = document.getElementById('meaningQuizOptions');
        const quizFeedbackElement = document.getElementById('quizFeedback');
        const nextQuizButton = document.getElementById('nextQuizButton');
        const exitQuizButton = document.getElementById('exitQuizButton');

        // New DOM elements for Sentence Reordering Quiz
        const sentenceQuizContainer = document.getElementById('sentenceQuizContainer');
        const scrambledWordsContainer = document.getElementById('scrambledWordsContainer');
        const sentenceBuilderContainer = document.getElementById('sentenceBuilderContainer');
        const checkSentenceButton = document.getElementById('checkSentenceButton');
        const resetSentenceButton = document.getElementById('resetSentenceButton');

        // New DOM elements for Speech Practice
        const startSpeechButton = document.getElementById('startSpeechButton');
        const stopSpeechButton = document.getElementById('stopSpeechButton');
        const speechRecognizedText = document.getElementById('speechRecognizedText');
        const speechFeedback = document.getElementById('speechFeedback');

        /**
         * Initializes the Web Speech Recognition API.
         */
        function initializeSpeechRecognition() {
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US'; // Set recognition language to English
                recognition.interimResults = false; // Only return final results
                recognition.maxAlternatives = 1; // Get only the most probable result

                recognition.onstart = () => {
                    isRecognizing = true;
                    startSpeechButton.disabled = true;
                    stopSpeechButton.disabled = false;
                    speechRecognizedText.textContent = "Listening...";
                    speechFeedback.textContent = "";
                    speechFeedback.classList.remove('correct', 'incorrect');
                    speechFeedback.classList.add('listening');
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    speechRecognizedText.textContent = `You said: "${transcript}"`;
                    checkPronunciation(transcript);
                };

                recognition.onend = () => {
                    isRecognizing = false;
                    startSpeechButton.disabled = false;
                    stopSpeechButton.disabled = true;
                    if (speechRecognizedText.textContent === "Listening...") {
                        speechRecognizedText.textContent = "Say the word or sentence..."; // Reset if nothing was said
                    }
                    speechFeedback.classList.remove('listening');
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    speechFeedback.textContent = `Error: ${event.error}`;
                    speechFeedback.classList.add('incorrect');
                    isRecognizing = false;
                    startSpeechButton.disabled = false;
                    stopSpeechButton.disabled = true;
                    speechRecognizedText.textContent = "Say the word or sentence...";
                };
            } else {
                startSpeechButton.disabled = true;
                stopSpeechButton.disabled = true;
                speechRecognizedText.textContent = "Speech Recognition not supported in this browser.";
                alert("Your browser does not support Web Speech Recognition. Please try Chrome or Edge.");
            }
        }

        /**
         * Starts the speech recognition process.
         */
        function startSpeechPractice() {
            if (recognition && !isRecognizing) {
                recognition.start();
            }
        }

        /**
         * Stops the speech recognition process.
         */
        function stopSpeechPractice() {
            if (recognition && isRecognizing) {
                recognition.stop();
            }
        }

        /**
         * Checks the recognized speech against the current word or sentence.
         * @param {string} recognizedText - The text transcribed by speech recognition.
         */
        function checkPronunciation(recognizedText) {
            const currentWordData = vocabulary[currentWordIndex];
            const targetWord = currentWordData.word.toLowerCase();
            const targetSentence = currentWordData.sentence.toLowerCase().replace(/[.,!?;:"]/g, ''); // Clean sentence

            const cleanRecognizedText = recognizedText.toLowerCase().trim().replace(/[.,!?;:"]/g, '');

            // Check against word first, then sentence
            if (cleanRecognizedText === targetWord) {
                speechFeedback.textContent = "Great! You pronounced the word correctly! üéâ";
                speechFeedback.classList.add('correct');
                speechFeedback.classList.remove('incorrect');
            } else if (cleanRecognizedText === targetSentence) {
                speechFeedback.textContent = "Excellent! You pronounced the sentence correctly! üéâ";
                speechFeedback.classList.add('correct');
                speechFeedback.classList.remove('incorrect');
            } else {
                speechFeedback.textContent = `Try again. You said: "${recognizedText}". Target: "${currentWordData.word}" or "${currentWordData.sentence}".`;
                speechFeedback.classList.add('incorrect');
                speechFeedback.classList.remove('correct');
            }
        }


        /**
         * Displays the word at the currentWordIndex in the UI.
         */
        function displayWord() {
            if (vocabulary.length === 0) {
                wordElement.textContent = "No words available.";
                meaningElement.textContent = "";
                sentenceElement.textContent = "";
                wordThemeElement.textContent = "";
                pronounceWordButton.disabled = true;
                pronounceSentenceButton.disabled = true;
                speechRateInput.disabled = true;
                favoriteButton.disabled = true;
                startSpeechButton.disabled = true; // Disable speech practice buttons
                stopSpeechButton.disabled = true;
                speechRecognizedText.textContent = "Say the word or sentence...";
                speechFeedback.textContent = "";
                speechFeedback.classList.remove('correct', 'incorrect', 'listening');
                return;
            }

            const wordData = vocabulary[currentWordIndex];
            wordElement.textContent = wordData.word;
            meaningElement.textContent = wordData.meaning;
            sentenceElement.textContent = wordData.sentence;
            wordThemeElement.textContent = `Theme: ${wordData.theme}`;
            pronounceWordButton.disabled = false;
            pronounceSentenceButton.disabled = false;
            speechRateInput.disabled = false;
            favoriteButton.disabled = false;
            startSpeechButton.disabled = false; // Enable speech practice buttons
            stopSpeechButton.disabled = true; // Stop button starts disabled
            speechRecognizedText.textContent = "Say the word or sentence..."; // Reset text
            speechFeedback.textContent = ""; // Clear feedback
            speechFeedback.classList.remove('correct', 'incorrect', 'listening');
            updateFavoriteButton();
        }

        /**
         * Updates the favorite button's appearance based on whether the current word is favorited.
         */
        function updateFavoriteButton() {
            const currentWord = vocabulary[currentWordIndex].word;
            if (favoriteWords.includes(currentWord)) {
                favoriteButton.classList.add('favorited');
                favoriteButton.innerHTML = '<span class="star-icon">‚òÖ</span> Favorited';
            } else {
                favoriteButton.classList.remove('favorited');
                favoriteButton.innerHTML = '<span class="star-icon">‚òÜ</span> Favorite';
            }
        }

        /**
         * Toggles the favorite status of the current word and updates localStorage.
         */
        function toggleFavorite() {
            const currentWord = vocabulary[currentWordIndex].word;
            const index = favoriteWords.indexOf(currentWord);
            if (index > -1) {
                // Word is already favorited, remove it
                favoriteWords.splice(index, 1);
            } else {
                // Word is not favorited, add it
                favoriteWords.push(currentWord);
            }
            localStorage.setItem('favoriteWords', JSON.stringify(favoriteWords));
            updateFavoriteButton();
        }

        /**
         * Pronounces the given text using the Web Speech API.
         * @param {string} textToSpeak - The text to be pronounced.
         */
        function speakText(textToSpeak) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                utterance.lang = 'en-US'; // Set language to English
                utterance.rate = parseFloat(speechRateInput.value); // Set speech rate
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn("Speech Synthesis API not supported in this browser.");
                alert("Your browser does not support text-to-speech. Please try a different browser.");
            }
        }

        /**
         * Pronounces the current word.
         */
        function pronounceWord() {
            speakText(vocabulary[currentWordIndex].word);
        }

        /**
         * Pronounces the current sentence.
         */
        function pronounceSentence() {
            speakText(vocabulary[currentWordIndex].sentence);
        }

        /**
         * Updates the displayed speech rate value.
         */
        function updateRateDisplay() {
            currentRateDisplay.textContent = `${speechRateInput.value}x`;
        }

        /**
         * Moves to the next word in the vocabulary list.
         */
        function nextWord() {
            currentWordIndex = (currentWordIndex + 1) % vocabulary.length;
            displayWord();
        }

        /**
         * Moves to the previous word in the vocabulary list.
         */
        function prevWord() {
            currentWordIndex = (currentWordIndex - 1 + vocabulary.length) % vocabulary.length;
            displayWord();
        }

        /**
         * Displays a random word from the vocabulary list.
         */
        function shuffleWord() {
            currentWordIndex = Math.floor(Math.random() * vocabulary.length);
            displayWord();
        }

        /**
         * Searches for a word and displays it if found.
         * If multiple matches, it displays the first one.
         */
        function searchWord() {
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (searchTerm === "") {
                displayWord();
                return;
            }

            const foundIndex = vocabulary.findIndex(wordObj =>
                wordObj.word.toLowerCase().includes(searchTerm) ||
                wordObj.meaning.toLowerCase().includes(searchTerm)
            );

            if (foundIndex !== -1) {
                currentWordIndex = foundIndex;
                displayWord();
                searchInput.value = '';
            } else {
                alert(`Word "${searchTerm}" not found.`);
            }
        }

        /**
         * Starts or exits the quiz mode.
         */
        function toggleQuizMode() {
            inQuizMode = !inQuizMode;
            if (inQuizMode) {
                quizSection.classList.add('active');
                document.querySelector('.word-display').style.display = 'none';
                document.querySelector('.control-buttons').style.display = 'none';
                document.querySelector('.search-container').style.display = 'none';
                toggleQuizButton.textContent = 'Exit Quiz';
                generateQuizQuestion();
            } else {
                quizSection.classList.remove('active');
                document.querySelector('.word-display').style.display = 'flex';
                document.querySelector('.control-buttons').style.display = 'flex';
                document.querySelector('.search-container').style.display = 'flex';
                toggleQuizButton.textContent = 'Start Quiz';
                quizFeedbackElement.textContent = '';
                nextQuizButton.style.display = 'none';
                displayWord();
            }
        }

        /**
         * Generates a new quiz question based on currentQuizType.
         */
        function generateQuizQuestion() {
            quizFeedbackElement.textContent = '';
            nextQuizButton.style.display = 'none';

            // Randomly choose between meaning quiz and sentence reordering quiz
            currentQuizType = Math.random() < 0.5 ? 'meaning' : 'sentence';

            if (currentQuizType === 'meaning') {
                meaningQuizOptions.classList.add('active');
                sentenceQuizContainer.classList.remove('active');
                generateMeaningQuiz();
            } else {
                // Ensure there's a sentence to quiz on
                const wordsWithSentences = vocabulary.filter(word => word.sentence && word.sentence.length > 0);
                if (wordsWithSentences.length === 0) {
                    alert("No words with sample sentences available for sentence reordering quiz.");
                    toggleQuizMode(); // Exit quiz if no sentences
                    return;
                }
                meaningQuizOptions.classList.remove('active');
                sentenceQuizContainer.classList.add('active');
                generateSentenceReorderingQuiz();
            }
        }

        /**
         * Generates a meaning/word quiz question.
         */
        function generateMeaningQuiz() {
            // Select a random word for the quiz
            const correctWordIndex = Math.floor(Math.random() * vocabulary.length);
            currentQuizWord = vocabulary[correctWordIndex];

            // Determine if we're asking for the word from the meaning or vice versa
            const questionType = Math.random() < 0.5 ? 'meaningToWord' : 'wordToMeaning';

            let questionText = '';
            let correctAnswer = '';
            if (questionType === 'meaningToWord') {
                questionText = `What is the English word for "${currentQuizWord.meaning}"?`;
                correctAnswer = currentQuizWord.word;
            } else {
                questionText = `What is the meaning of "${currentQuizWord.word}"?`;
                correctAnswer = currentQuizWord.meaning;
            }
            quizQuestionElement.textContent = questionText;

            // Generate options
            const options = [correctAnswer];
            while (options.length < 4) {
                const randomOtherWordIndex = Math.floor(Math.random() * vocabulary.length);
                const randomOtherWord = vocabulary[randomOtherWordIndex];
                let potentialOption = questionType === 'meaningToWord' ? randomOtherWord.word : randomOtherWord.meaning;

                if (!options.includes(potentialOption) && potentialOption !== correctAnswer) {
                    options.push(potentialOption);
                }
            }

            // Shuffle options
            options.sort(() => Math.random() - 0.5);

            meaningQuizOptions.innerHTML = ''; // Clear previous options
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('btn-secondary');
                button.onclick = () => checkMeaningAnswer(option, correctAnswer);
                meaningQuizOptions.appendChild(button);
            });
        }

        /**
         * Checks the user's meaning/word quiz answer.
         * @param {string} selectedOption - The option selected by the user.
         * @param {string} correctAnswer - The correct answer for the question.
         */
        function checkMeaningAnswer(selectedOption, correctAnswer) {
            // Disable all option buttons after selection
            Array.from(meaningQuizOptions.children).forEach(button => {
                button.disabled = true;
                if (button.textContent === correctAnswer) {
                    button.classList.remove('btn-secondary');
                    button.classList.add('btn-success'); // Highlight correct answer
                } else if (button.textContent === selectedOption) {
                    button.classList.remove('btn-secondary');
                    button.classList.add('btn-danger'); // Highlight incorrect selection
                }
            });

            if (selectedOption === correctAnswer) {
                quizFeedbackElement.textContent = "Correct! üéâ";
                quizFeedbackElement.style.color = '#48bb78'; // Green
            } else {
                quizFeedbackElement.textContent = `Incorrect. The correct answer was "${correctAnswer}".`;
                quizFeedbackElement.style.color = '#ef4444'; // Red
            }
            nextQuizButton.style.display = 'block'; // Show next question button
        }

        /**
         * Generates a sentence reordering quiz question.
         */
        function generateSentenceReorderingQuiz() {
            quizQuestionElement.textContent = "Arrange the words to form the correct sentence:";
            quizFeedbackElement.textContent = '';
            nextQuizButton.style.display = 'none';

            // Select a random word that has a sentence
            const wordsWithSentences = vocabulary.filter(word => word.sentence && word.sentence.length > 0);
            const correctWordIndex = Math.floor(Math.random() * wordsWithSentences.length);
            currentQuizWord = wordsWithSentences[correctWordIndex];

            // Clean and split the sentence into words
            const sentence = currentQuizWord.sentence;
            // Remove punctuation and split by spaces, filter out empty strings
            originalSentenceWords = sentence.replace(/[.,!?;:"]/g, '').split(/\s+/).filter(word => word.length > 0);

            // Create scrambled words for display
            const scrambledWords = [...originalSentenceWords]; // Copy the array
            // Shuffle the copied array
            for (let i = scrambledWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [scrambledWords[i], scrambledWords[j]] = [scrambledWords[j], scrambledWords[i]];
            }

            // Initialize built sentence and scrambled word buttons
            builtSentenceWords = [];
            scrambledWordButtons = scrambledWords.map((word, index) => {
                const button = document.createElement('button');
                button.textContent = word;
                button.classList.add('scrambled-word-button');
                button.dataset.originalIndex = index; // Store original index for re-enabling
                button.onclick = (event) => addWordToSentence(event.target);
                return { word: word, element: button, originalIndex: index };
            });

            renderSentenceQuizUI();
        }

        /**
         * Renders the UI for the sentence reordering quiz.
         */
        function renderSentenceQuizUI() {
            scrambledWordsContainer.innerHTML = '';
            sentenceBuilderContainer.innerHTML = '';

            // Render scrambled words
            scrambledWordButtons.forEach(btnObj => {
                scrambledWordsContainer.appendChild(btnObj.element);
            });

            // Render built sentence
            builtSentenceWords.forEach((word, index) => {
                const span = document.createElement('span');
                span.textContent = word;
                span.classList.add('built-word');
                // Store the index in builtSentenceWords for removal
                span.dataset.builtIndex = index;
                span.onclick = (event) => removeWordFromSentence(event.target);
                sentenceBuilderContainer.appendChild(span);
                if (index < builtSentenceWords.length - 1) {
                    sentenceBuilderContainer.appendChild(document.createTextNode(' ')); // Add space between words
                }
            });
        }

        /**
         * Adds a word to the sentence builder when a scrambled word button is clicked.
         * @param {HTMLElement} clickedButton - The button element that was clicked.
         */
        function addWordToSentence(clickedButton) {
            builtSentenceWords.push(clickedButton.textContent);
            clickedButton.disabled = true; // Disable the button after it's used
            clickedButton.classList.remove('scrambled-word-button');
            clickedButton.classList.add('btn-secondary'); // Change style to indicate it's used
            renderSentenceQuizUI();
        }

        /**
         * Removes a word from the sentence builder when a built word is clicked.
         * @param {HTMLElement} clickedSpan - The span element representing the word in the builder.
         */
        function removeWordFromSentence(clickedSpan) {
            const indexToRemove = parseInt(clickedSpan.dataset.builtIndex);
            const wordToRemove = builtSentenceWords[indexToRemove];

            // Remove from builtSentenceWords
            builtSentenceWords.splice(indexToRemove, 1);

            // Re-enable the corresponding scrambled word button
            const correspondingButton = scrambledWordButtons.find(btnObj =>
                btnObj.element.textContent === wordToRemove && btnObj.element.disabled
            );

            if (correspondingButton) {
                correspondingButton.element.disabled = false;
                correspondingButton.element.classList.remove('btn-secondary');
                correspondingButton.element.classList.add('scrambled-word-button');
            }
            renderSentenceQuizUI();
        }


        /**
         * Checks if the built sentence matches the original sentence.
         */
        function checkSentence() {
            const builtSentence = builtSentenceWords.join(' ').toLowerCase();
            const correctSentence = originalSentenceWords.join(' ').toLowerCase();

            if (builtSentence === correctSentence) {
                quizFeedbackElement.textContent = "Correct! ÔøΩ";
                quizFeedbackElement.style.color = '#48bb78'; // Green
            } else {
                quizFeedbackElement.textContent = `Incorrect. The correct sentence was: "${currentQuizWord.sentence}".`;
                quizFeedbackElement.style.color = '#ef4444'; // Red
            }
            nextQuizButton.style.display = 'block'; // Show next question button
            // Disable all scrambled word buttons after checking
            scrambledWordButtons.forEach(btnObj => btnObj.element.disabled = true);
            // Disable built words from being removed
            Array.from(sentenceBuilderContainer.children).forEach(span => span.onclick = null);
        }

        /**
         * Resets the sentence reordering quiz.
         */
        function resetSentenceQuiz() {
            builtSentenceWords = [];
            scrambledWordButtons.forEach(btnObj => {
                btnObj.element.disabled = false;
                btnObj.element.classList.remove('btn-secondary');
                btnObj.element.classList.add('scrambled-word-button');
            });
            quizFeedbackElement.textContent = '';
            nextQuizButton.style.display = 'none';
            renderSentenceQuizUI();
        }


        // Event Listeners
        pronounceWordButton.addEventListener('click', pronounceWord);
        pronounceSentenceButton.addEventListener('click', pronounceSentence);
        speechRateInput.addEventListener('input', updateRateDisplay);
        nextButton.addEventListener('click', nextWord);
        prevButton.addEventListener('click', prevWord);
        shuffleButton.addEventListener('click', shuffleWord);
        searchButton.addEventListener('click', searchWord);
        favoriteButton.addEventListener('click', toggleFavorite);
        toggleQuizButton.addEventListener('click', toggleQuizMode);
        nextQuizButton.addEventListener('click', generateQuizQuestion);
        exitQuizButton.addEventListener('click', toggleQuizMode);

        // New Event Listeners for Sentence Reordering Quiz
        checkSentenceButton.addEventListener('click', checkSentence);
        resetSentenceButton.addEventListener('click', resetSentenceQuiz);

        // New Event Listeners for Speech Practice
        startSpeechButton.addEventListener('click', startSpeechPractice);
        stopSpeechButton.addEventListener('click', stopSpeechPractice);


        // Initial display and initialization when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeSpeechRecognition(); // Initialize speech recognition on load
            displayWord();
            updateRateDisplay();
        });
    </script>
</body>
</html>
